@use '../../../app/app.scss' as *;

.sidebar {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: $z-modal; // ✅ Z-index du système

  .bg {
    z-index: $z-modal;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: clamp(18rem, 25vw, 22rem); // ✅ Responsive fluide

    // ✅ Background moderne avec glassmorphism
    background: linear-gradient(
      135deg,
      rgba($background-color-light, 0.95) 0%,
      rgba($background-color, 0.98) 50%,
      rgba($background-color-dark, 0.95) 100%
    );

    // ✅ Glassmorphism avancé
    @include glassmorphism(0.1, 25px, 200%);

    // ✅ Bordures et ombres du système
    border-right: 1px solid rgba($primary-color, 0.15);
    box-shadow:
      $box-shadow-strong,
      inset -1px 0 0 rgba($primary-color, 0.1);

    // ✅ Effet de gradient décoratif sur le bord
    &::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 3px;
      height: 100%;
      background: $gradient-rainbow;
      background-size: 100% 200%;
      animation: gradientVerticalFlow 6s linear infinite;

      @include reduced-motion {
        animation: none;
        background: $primary-color;
      }
    }

    // ✅ Effet de lueur décorative
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 80%;
      height: 60%;
      background: radial-gradient(
        ellipse,
        rgba($primary-color, 0.05) 0%,
        rgba($secondary-color, 0.03) 50%,
        transparent 80%
      );
      transform: translate(-50%, -50%);
      z-index: -1;
      animation: pulseGlow 4s ease-in-out infinite alternate;

      @include reduced-motion {
        animation: none;
        opacity: 0.5;
      }
    }

    // ✅ Responsive avec mixins du système
    @include md-down {
      width: clamp(16rem, 30vw, 18rem);
    }

    @include sm-down {
      width: clamp(14rem, 35vw, 16rem);
    }

    .links {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: $spacing-lg; // ✅ Variable du système
      font-size: clamp(1.2rem, 3vw, 2rem); // ✅ Responsive fluide
      padding: $spacing-xl; // ✅ Variable du système

      .link {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        padding: $spacing-md $spacing-lg; // ✅ Variables du système
        border-radius: $border-radius-medium; // ✅ Variable du système
        transition: all $transition-elastic; // ✅ Variable du système
        position: relative;
        overflow: hidden;
        cursor: pointer;

        // ✅ État par défaut avec glassmorphism subtil
        @include glassmorphism(0.02, 10px);
        border: 1px solid rgba($primary-color, 0.08);

        // ✅ Effet de vague au hover
        @include button-hover-effect(200px);

        // ✅ Effet de brillance
        &::after {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 50%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba($primary-color, 0.1),
            transparent
          );
          transition: left 0.8s $transition-smooth;
          z-index: 1;
        }

        &:hover {
          @include glassmorphism(0.08, 15px);
          background: linear-gradient(
            135deg,
            rgba($primary-color, 0.1) 0%,
            rgba($secondary-color, 0.08) 50%,
            rgba($accent-color, 0.06) 100%
          );
          border-color: rgba($primary-color, 0.2);
          transform: translateX($spacing-md) scale(1.02); // ✅ Variable du système
          box-shadow:
            0 8px 25px rgba($primary-color, 0.15),
            inset 0 1px 0 rgba($text-color, 0.1);

          &::after {
            left: 100%;
          }
        }

        &:active {
          transform: translateX($spacing-sm) scale(0.98);
        }

        a {
          color: $text-color;
          text-decoration: none;
          font-weight: 600; // ✅ Plus lisible
          transition: all $transition-smooth; // ✅ Variable du système
          position: relative;
          z-index: 2;
          width: 100%;
          @include text-shadow-glow($primary-color, 0.1); // ✅ Mixin du système

          &:hover {
            color: $primary-color;
            @include text-shadow-glow($primary-color, 0.3);
          }

          &:focus {
            outline: none;
            color: $secondary-color;
            @include text-shadow-glow($secondary-color, 0.4);
          }
        }

        // ✅ Icône décorative moderne
        &::before {
          content: '';
          width: 6px;
          height: 6px;
          background: $gradient-primary;
          border-radius: 50%;
          margin-right: $spacing-md;
          transition: all $transition-elastic;
          box-shadow: 0 0 8px rgba($primary-color, 0.4);
        }

        &:hover::before {
          background: $gradient-secondary;
          transform: scale(1.3);
          box-shadow: 0 0 12px rgba($secondary-color, 0.6);
        }

        // ✅ Animation d'entrée personnalisée pour chaque lien
        &:nth-child(1) {
          animation: linkSlideIn 0.6s $transition-elastic 0.1s both;
        }
        &:nth-child(2) {
          animation: linkSlideIn 0.6s $transition-elastic 0.2s both;
        }
        &:nth-child(3) {
          animation: linkSlideIn 0.6s $transition-elastic 0.3s both;
        }
        &:nth-child(4) {
          animation: linkSlideIn 0.6s $transition-elastic 0.4s both;
        }
        &:nth-child(5) {
          animation: linkSlideIn 0.6s $transition-elastic 0.5s both;
        }

        @include reduced-motion {
          animation: fadeIn 0.4s ease-out both;
        }
      }
    }
  }

  // ✅ Bouton toggle modernisé
  .toggle-button {
    z-index: $z-modal + 1;
    width: clamp(2.5rem, 5vw, 3rem); // ✅ Responsive
    height: clamp(2.5rem, 5vw, 3rem);
    border-radius: 50%;
    position: fixed;
    top: $spacing-xl; // ✅ Variable du système
    left: $spacing-xl;

    // ✅ Style moderne avec glassmorphism
    @include glassmorphism(0.1, 20px);
    background: rgba($background-color-light, 0.8);
    border: 2px solid rgba($primary-color, 0.2);
    cursor: pointer;
    transition: all $transition-elastic; // ✅ Variable du système

    box-shadow:
      $box-shadow-medium,
      inset 0 1px 0 rgba($text-color, 0.1);

    // ✅ Effet de glow au hover
    &:hover {
      @include glassmorphism(0.15, 25px);
      background: rgba($primary-color, 0.1);
      border-color: rgba($primary-color, 0.4);
      transform: scale(1.1);
      box-shadow:
        $box-shadow-hover,
        0 0 20px rgba($primary-color, 0.3);
    }

    &:active {
      transform: scale(1.05);
    }

    &:focus {
      outline: none;
      box-shadow:
        $box-shadow-medium, $box-shadow-focus; // ✅ Variable du système
    }

    // ✅ Animation de rotation au click
    &.active {
      transform: rotate(180deg) scale(1.05);
      background: rgba($secondary-color, 0.1);
      border-color: rgba($secondary-color, 0.4);
    }

    svg {
      width: 60%;
      height: 60%;
      transition: all $transition-smooth;

      path {
        stroke: $text-color; // ✅ Variable du système
        stroke-width: 2.5;
        transition: all $transition-smooth;
        filter: drop-shadow(0 1px 2px rgba($background-color, 0.3));
      }

      &:hover path {
        stroke: $primary-color;
        filter: drop-shadow(0 2px 4px rgba($primary-color, 0.4));
      }
    }
  }
}

// ===== ANIMATIONS MODERNES =====

@keyframes gradientVerticalFlow {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 0% 200%;
  }
}

@keyframes pulseGlow {
  from {
    opacity: 0.05;
    transform: translate(-50%, -50%) scale(1);
  }
  to {
    opacity: 0.1;
    transform: translate(-50%, -50%) scale(1.05);
  }
}

@keyframes linkSlideIn {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

// ✅ Animation de fermeture
@keyframes linkSlideOut {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(-30px);
  }
}

// ===== ÉTATS SPÉCIAUX =====

// ✅ Sidebar fermée
.sidebar[data-state='closed'] {
  .bg .links .link {
    animation: linkSlideOut 0.3s ease-in both;

    &:nth-child(1) {
      animation-delay: 0s;
    }
    &:nth-child(2) {
      animation-delay: 0.05s;
    }
    &:nth-child(3) {
      animation-delay: 0.1s;
    }
    &:nth-child(4) {
      animation-delay: 0.15s;
    }
    &:nth-child(5) {
      animation-delay: 0.2s;
    }
  }
}

// ✅ Lien actif
.sidebar .bg .links .link.active {
  @include glassmorphism(0.12, 18px);
  background: linear-gradient(
    135deg,
    rgba($primary-color, 0.15) 0%,
    rgba($secondary-color, 0.1) 100%
  );
  border-color: rgba($primary-color, 0.3);
  transform: translateX($spacing-md);

  a {
    color: $primary-color;
    @include text-shadow-glow($primary-color, 0.4);
  }

  &::before {
    background: $gradient-accent;
    transform: scale(1.5);
    box-shadow: 0 0 15px rgba($accent-color, 0.6);
  }
}

// ===== RESPONSIVE AVANCÉ =====

@include md-down {
  .sidebar {
    .bg {
      .links {
        gap: $spacing-md;
        padding: $spacing-lg;
        font-size: clamp(1rem, 3.5vw, 1.4rem);

        .link {
          padding: $spacing-sm $spacing-md;
        }
      }
    }

    .toggle-button {
      top: $spacing-lg;
      left: $spacing-lg;
    }
  }
}

@include sm-down {
  .sidebar {
    .bg {
      .links {
        gap: $spacing-sm;
        padding: $spacing-md;
        font-size: clamp(0.9rem, 4vw, 1.2rem);

        .link {
          padding: $spacing-xs $spacing-sm;

          &:hover {
            transform: translateX($spacing-sm) scale(1.01);
          }
        }
      }
    }

    .toggle-button {
      top: $spacing-md;
      left: $spacing-md;
    }
  }
}

// ===== SUPPORT ACCESSIBILITÉ =====

@include reduced-motion {
  .sidebar {
    .bg {
      &::before,
      &::after {
        animation: none !important;
      }

      .links .link {
        animation: fadeIn 0.3s ease-out both !important;

        &:hover {
          transform: translateX($spacing-sm);
        }

        &::after {
          transition: none;
        }
      }
    }

    .toggle-button {
      transition:
        transform 0.2s ease,
        background-color 0.2s ease !important;

      &:hover {
        transform: scale(1.05);
      }
    }
  }
}

// ===== SUPPORT DARK MODE =====

@include dark-mode {
  .sidebar {
    .bg {
      background: linear-gradient(
        135deg,
        rgba($background-color-dark, 0.98) 0%,
        rgba($background-color, 0.99) 50%,
        rgba($background-color-light, 0.96) 100%
      );

      border-right-color: rgba($primary-color, 0.2);

      .links .link {
        border-color: rgba($primary-color, 0.12);

        &:hover {
          border-color: rgba($primary-color, 0.25);
        }

        a {
          color: rgba($text-color, 0.9);
        }
      }
    }

    .toggle-button {
      background: rgba($background-color-dark, 0.9);
      border-color: rgba($primary-color, 0.25);

      svg path {
        stroke: rgba($text-color, 0.8);
      }
    }
  }
}

// ===== OPTIMISATIONS PERFORMANCE =====

@include touch-device {
  .sidebar {
    .bg {
      &::before {
        animation-duration: 8s;
      }

      .links .link {
        &::after {
          transition-duration: 0.4s;
        }
      }
    }
  }
}

// ===== VARIANTES =====

// ✅ Sidebar compacte
.sidebar.compact {
  .bg {
    width: clamp(12rem, 20vw, 16rem);

    .links {
      gap: $spacing-sm;
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);

      .link {
        padding: $spacing-sm;
      }
    }
  }
}

// ✅ Sidebar avec icônes (si vous ajoutez des icônes plus tard)
.sidebar.with-icons {
  .bg .links .link {
    justify-content: flex-start;

    .icon {
      width: 20px;
      height: 20px;
      margin-right: $spacing-sm;
      color: $primary-color;
      transition: all $transition-smooth;
    }

    &:hover .icon {
      color: $secondary-color;
      transform: scale(1.1) rotate(5deg);
    }
  }
}
