// components/layouts/sidebar/sidebar.scss
// ===== IMPORTS CORRIGÉS =====
@use '../../../app/app.scss' as *;

.sidebar {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: $z-modal;

  // ===== GESTION HAUTEURS ADAPTATIVES =====
  @include very-short-screen {
    .bg {
      .links {
        gap: $spacing-sm;
        padding: $spacing-md;
        font-size: clamp(0.9rem, 3vw, 1.1rem);
      }
    }

    .toggle-button {
      top: $spacing-sm;
      left: $spacing-sm;
      width: 2.5rem;
      height: 2.5rem;
    }
  }

  @include mobile-landscape {
    .bg {
      width: clamp(12rem, 20vw, 15rem);

      .links {
        gap: $spacing-sm;
        padding: $spacing-md;
        font-size: clamp(0.8rem, 2.5vw, 1rem);
      }
    }

    .toggle-button {
      top: $spacing-md;
      left: $spacing-md;
      width: 2.8rem;
      height: 2.8rem;
    }
  }

  @include wide-but-short {
    .bg {
      .links {
        justify-content: flex-start;
        padding-top: $spacing-3xl;
      }
    }
  }

  .bg {
    z-index: $z-modal;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: clamp(18rem, 25vw, 22rem);

    // Background moderne avec glassmorphism
    background: linear-gradient(
      135deg,
      rgba($background-color-light, 0.95) 0%,
      rgba($background-color, 0.98) 50%,
      rgba($background-color-dark, 0.95) 100%
    );

    // Glassmorphism avancé avec mixin du système
    @include glassmorphism(0.1, 25px, 200%);

    // Bordures et ombres du système
    border-right: 1px solid rgba($primary-color, 0.15);
    box-shadow:
      $box-shadow-strong,
      inset -1px 0 0 rgba($primary-color, 0.1);

    // Effet de gradient décoratif sur le bord
    &::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 3px;
      height: 100%;
      background: $gradient-rainbow;
      background-size: 100% 200%;
      animation: gradientVerticalFlow 6s linear infinite;

      @include reduced-motion {
        animation: none;
        background: $primary-color;
      }
    }

    // Effet de lueur décorative
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 80%;
      height: 60%;
      background: radial-gradient(
        ellipse,
        rgba($primary-color, 0.05) 0%,
        rgba($secondary-color, 0.03) 50%,
        transparent 80%
      );
      transform: translate(-50%, -50%);
      z-index: -1;
      animation: pulseGlow 4s ease-in-out infinite alternate;

      @include reduced-motion {
        animation: none;
        opacity: 0.5;
      }
    }

    // ===== RESPONSIVE AVEC MIXINS DU SYSTÈME =====
    @include md-down {
      width: clamp(16rem, 30vw, 18rem);
    }

    @include sm-down {
      width: clamp(14rem, 35vw, 16rem);
    }

    @include xs-only {
      width: clamp(12rem, 40vw, 14rem);
    }

    @include very-short-screen {
      width: clamp(10rem, 35vw, 12rem);
    }

    @include mobile-landscape {
      width: clamp(12rem, 25vw, 14rem);
    }

    .links {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: $spacing-lg;
      font-size: clamp(1.2rem, 3vw, 2rem);
      padding: $spacing-xl;

      @include very-short-screen {
        justify-content: flex-start;
        padding-top: $spacing-3xl;
        gap: $spacing-md;
      }

      @include mobile-landscape {
        justify-content: flex-start;
        padding-top: $spacing-2xl;
        gap: $spacing-sm;
      }

      .link {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        padding: $spacing-md $spacing-lg;
        border-radius: $border-radius-medium;
        transition: all $transition-elastic;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        min-height: 44px; // Touch minimum

        // État par défaut avec glassmorphism subtil
        @include glassmorphism(0.02, 10px);
        border: 1px solid rgba($primary-color, 0.08);

        // Effet de vague au hover
        @include button-hover-effect(200px);

        // Effet de brillance
        &::after {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 50%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba($primary-color, 0.1),
            transparent
          );
          transition: left 0.8s $transition-smooth;
          z-index: 1;
        }

        &:hover {
          @include glassmorphism(0.08, 15px);
          background: linear-gradient(
            135deg,
            rgba($primary-color, 0.1) 0%,
            rgba($secondary-color, 0.08) 50%,
            rgba($accent-color, 0.06) 100%
          );
          border-color: rgba($primary-color, 0.2);
          transform: translateX($spacing-md) scale(1.02);
          box-shadow:
            0 8px 25px rgba($primary-color, 0.15),
            inset 0 1px 0 rgba($text-color, 0.1);

          &::after {
            left: 100%;
          }

          @include very-short-screen {
            transform: translateX($spacing-sm) scale(1.01);
          }

          @include mobile-landscape {
            transform: translateX($spacing-xs) scale(1.01);
          }
        }

        &:active {
          transform: translateX($spacing-sm) scale(0.98);
        }

        &:focus-within {
          @include glassmorphism(0.08, 15px);
          border-color: rgba($primary-color, 0.3);
          box-shadow: $box-shadow-focus;
        }

        a {
          color: $text-color;
          text-decoration: none;
          font-weight: 600;
          transition: all $transition-smooth;
          position: relative;
          z-index: 2;
          width: 100%;
          @include text-shadow-glow($primary-color, 0.1);

          &:hover {
            color: $primary-color;
            @include text-shadow-glow($primary-color, 0.3);
          }

          &:focus {
            outline: none;
            color: $secondary-color;
            @include text-shadow-glow($secondary-color, 0.4);
          }
        }

        // Icône décorative moderne
        &::before {
          content: '';
          width: 6px;
          height: 6px;
          background: $gradient-primary;
          border-radius: 50%;
          margin-right: $spacing-md;
          transition: all $transition-elastic;
          box-shadow: 0 0 8px rgba($primary-color, 0.4);
          flex-shrink: 0;
        }

        &:hover::before {
          background: $gradient-secondary;
          transform: scale(1.3);
          box-shadow: 0 0 12px rgba($secondary-color, 0.6);
        }

        // Responsive adjustments
        @include sm-down {
          padding: $spacing-sm $spacing-md;
          min-height: 40px;

          &::before {
            width: 4px;
            height: 4px;
            margin-right: $spacing-sm;
          }
        }

        @include very-short-screen {
          padding: $spacing-xs $spacing-sm;
          min-height: 36px;

          &::before {
            width: 3px;
            height: 3px;
            margin-right: $spacing-xs;
          }
        }

        @include mobile-landscape {
          padding: $spacing-xs $spacing-sm;
          min-height: 32px;
        }

        @include touch-device {
          min-height: 44px;
        }

        // Animation d'entrée personnalisée pour chaque lien
        &:nth-child(1) {
          animation: linkSlideIn 0.6s $transition-elastic 0.1s both;
        }
        &:nth-child(2) {
          animation: linkSlideIn 0.6s $transition-elastic 0.2s both;
        }
        &:nth-child(3) {
          animation: linkSlideIn 0.6s $transition-elastic 0.3s both;
        }
        &:nth-child(4) {
          animation: linkSlideIn 0.6s $transition-elastic 0.4s both;
        }
        &:nth-child(5) {
          animation: linkSlideIn 0.6s $transition-elastic 0.5s both;
        }

        @include reduced-motion {
          animation: fadeIn 0.4s ease-out both;
        }
      }
    }
  }

  // ===== BOUTON TOGGLE MODERNISÉ =====
  .toggle-button {
    z-index: $z-modal + 1;
    width: clamp(2.5rem, 5vw, 3rem);
    height: clamp(2.5rem, 5vw, 3rem);
    border-radius: 50%;
    position: fixed;
    top: $spacing-xl;
    left: $spacing-xl;

    // Style moderne avec glassmorphism
    @include glassmorphism(0.1, 20px);
    background: rgba($background-color-light, 0.8);
    border: 2px solid rgba($primary-color, 0.2);
    cursor: pointer;
    transition: all $transition-elastic;

    box-shadow:
      $box-shadow-medium,
      inset 0 1px 0 rgba($text-color, 0.1);

    // Effet de glow au hover
    &:hover {
      @include glassmorphism(0.15, 25px);
      background: rgba($primary-color, 0.1);
      border-color: rgba($primary-color, 0.4);
      transform: scale(1.1);
      box-shadow:
        $box-shadow-hover,
        0 0 20px rgba($primary-color, 0.3);
    }

    &:active {
      transform: scale(1.05);
    }

    &:focus {
      outline: none;
      box-shadow: $box-shadow-medium, $box-shadow-focus;
    }

    // Animation de rotation au click
    &.active {
      transform: rotate(180deg) scale(1.05);
      background: rgba($secondary-color, 0.1);
      border-color: rgba($secondary-color, 0.4);

      &:hover {
        background: rgba($secondary-color, 0.15);
        border-color: rgba($secondary-color, 0.5);
      }
    }

    svg {
      width: 60%;
      height: 60%;
      transition: all $transition-smooth;
      color: $text-color;

      path {
        stroke: currentColor;
        stroke-width: 2.5;
        transition: all $transition-smooth;
        filter: drop-shadow(0 1px 2px rgba($background-color, 0.3));
      }
    }

    &:hover svg {
      color: $primary-color;

      path {
        filter: drop-shadow(0 2px 4px rgba($primary-color, 0.4));
      }
    }

    &.active svg {
      color: $secondary-color;
    }

    // Responsive adjustments
    @include sm-down {
      top: $spacing-lg;
      left: $spacing-lg;
    }

    @include xs-only {
      top: $spacing-md;
      left: $spacing-md;
      width: 2.5rem;
      height: 2.5rem;
    }

    @include very-short-screen {
      top: $spacing-sm;
      left: $spacing-sm;
      width: 2.2rem;
      height: 2.2rem;
    }

    @include mobile-landscape {
      top: $spacing-md;
      left: $spacing-md;
      width: 2.5rem;
      height: 2.5rem;
    }

    @include touch-device {
      min-width: 44px;
      min-height: 44px;
    }
  }
}

// ===== ANIMATIONS SPÉCIFIQUES SIDEBAR =====
// Note: fadeIn et pulseGlow sont maintenant dans _keyframes.scss

@keyframes gradientVerticalFlow {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 0% 200%;
  }
}

@keyframes linkSlideIn {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes linkSlideOut {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(-30px);
  }
}

// ===== ÉTATS SPÉCIAUX =====

// Sidebar fermée
.sidebar[data-state='closed'] {
  .bg .links .link {
    animation: linkSlideOut 0.3s ease-in both;

    &:nth-child(1) {
      animation-delay: 0s;
    }
    &:nth-child(2) {
      animation-delay: 0.05s;
    }
    &:nth-child(3) {
      animation-delay: 0.1s;
    }
    &:nth-child(4) {
      animation-delay: 0.15s;
    }
    &:nth-child(5) {
      animation-delay: 0.2s;
    }

    @include reduced-motion {
      animation: fadeOut 0.2s ease-in both;
    }
  }
}

// Lien actif
.sidebar .bg .links .link.active {
  @include glassmorphism(0.12, 18px);
  background: linear-gradient(
    135deg,
    rgba($primary-color, 0.15) 0%,
    rgba($secondary-color, 0.1) 100%
  );
  border-color: rgba($primary-color, 0.3);
  transform: translateX($spacing-md);

  a {
    color: $primary-color;
    @include text-shadow-glow($primary-color, 0.4);
  }

  &::before {
    background: $gradient-accent;
    transform: scale(1.5);
    box-shadow: 0 0 15px rgba($accent-color, 0.6);
  }
}

// ===== SUPPORT ACCESSIBILITÉ =====
@include reduced-motion {
  .sidebar {
    .bg {
      &::before,
      &::after {
        animation: none !important;
      }

      .links .link {
        animation: fadeIn 0.3s ease-out both !important;

        &:hover {
          transform: translateX($spacing-sm);
        }

        &::after {
          transition: none;
        }
      }
    }

    .toggle-button {
      transition:
        transform 0.2s ease,
        background-color 0.2s ease !important;

      &:hover {
        transform: scale(1.05);
      }

      &.active {
        transform: rotate(45deg) scale(1.05); // Rotation réduite
      }
    }
  }
}

// ===== SUPPORT DARK MODE =====
@include dark-mode {
  .sidebar {
    .bg {
      background: linear-gradient(
        135deg,
        rgba($background-color-dark, 0.98) 0%,
        rgba($background-color, 0.99) 50%,
        rgba($background-color-light, 0.96) 100%
      );

      border-right-color: rgba($primary-color, 0.2);

      .links .link {
        border-color: rgba($primary-color, 0.12);

        &:hover {
          border-color: rgba($primary-color, 0.25);
        }

        a {
          color: rgba($text-color, 0.9);
        }
      }
    }

    .toggle-button {
      background: rgba($background-color-dark, 0.9);
      border-color: rgba($primary-color, 0.25);

      svg {
        color: rgba($text-color, 0.8);
      }
    }
  }
}

// ===== OPTIMISATIONS PERFORMANCE =====
@include touch-device {
  .sidebar {
    .bg {
      &::before {
        animation-duration: 8s;
      }

      .links .link {
        &::after {
          transition-duration: 0.4s;
        }

        min-height: 44px;
      }
    }

    .toggle-button {
      min-width: 44px;
      min-height: 44px;
    }
  }
}

// ===== VARIANTES =====

// Sidebar compacte
.sidebar.compact {
  .bg {
    width: clamp(12rem, 20vw, 16rem);

    .links {
      gap: $spacing-sm;
      font-size: clamp(0.9rem, 2.5vw, 1.2rem);

      .link {
        padding: $spacing-sm;
      }
    }
  }
}

// Sidebar avec icônes (extension future)
.sidebar.with-icons {
  .bg .links .link {
    justify-content: flex-start;

    .icon {
      width: 20px;
      height: 20px;
      margin-right: $spacing-sm;
      color: $primary-color;
      transition: all $transition-smooth;
      flex-shrink: 0;
    }

    &:hover .icon {
      color: $secondary-color;
      transform: scale(1.1) rotate(5deg);
    }

    @include sm-down {
      .icon {
        width: 16px;
        height: 16px;
        margin-right: $spacing-xs;
      }
    }
  }
}

// ===== SUPPORT PORTRAIT SUR TABLETTES =====
@include portrait {
  .sidebar .bg {
    @include between(768px, 1024px) {
      width: clamp(14rem, 25vw, 18rem);

      .links {
        gap: $spacing-md;
        padding: $spacing-lg;
      }
    }
  }
}

// ===== GESTION OVERLAY (backdrop) =====
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba($background-color, 0.5);
  backdrop-filter: blur(5px);
  z-index: $z-modal - 1;
  opacity: 0;
  pointer-events: none;
  transition: all $transition-smooth;

  &.visible {
    opacity: 1;
    pointer-events: all;
  }

  @include reduced-motion {
    backdrop-filter: none;
    background: rgba($background-color, 0.7);
  }
}

// ===== STYLES ADDITIONNELS POUR LA SIDEBAR =====
// À ajouter à sidebar.scss

// ===== STYLES POUR LES LIENS AMÉLIORÉS =====
.sidebar .bg .links {
  .link {
    .link-content {
      display: flex;
      align-items: center;
      gap: $spacing-sm;
      width: 100%;
      position: relative;
    }

    .link-icon {
      font-size: 1.2em;
      opacity: 0.8;
      transition: all $transition-smooth;
      display: none; // Masqué par défaut, à activer si souhaité

      @include lg-up {
        display: inline-block;
      }
    }

    .link-text {
      flex: 1;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .active-indicator {
      width: 6px;
      height: 6px;
      background: $gradient-accent;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba($accent-color, 0.6);
      margin-left: auto;
    }

    &:hover .link-icon {
      transform: scale(1.2) rotate(5deg);
      opacity: 1;
    }

    // État actif amélioré
    &.active {
      .link-icon {
        transform: scale(1.1);
        opacity: 1;
      }

      .link-text {
        font-weight: 700;
      }
    }
  }

  // Footer de la sidebar
  .sidebar-footer {
    margin-top: auto;
    padding-top: $spacing-xl;
    text-align: center;
    border-top: 1px solid rgba($primary-color, 0.1);
    opacity: 0.7;

    .footer-text {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: $primary-color;
      margin-bottom: $spacing-xs;
    }

    .footer-version {
      font-size: 0.8rem;
      color: $text-color-muted;
      font-weight: 400;
    }

    @include sm-down {
      .footer-text {
        font-size: 0.8rem;
      }

      .footer-version {
        font-size: 0.7rem;
      }
    }
  }
}

// ===== STYLES POUR LE TOGGLE BUTTON AMÉLIORÉ =====
.toggle-button {
  // Effet de pulsation pour attirer l'attention
  &.pulse {
    animation: buttonPulse 2s ease-in-out infinite;
  }

  // Support pour les icônes alternatives
  .button-icon {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 2;
  }

  // Effet de brillance animé
  .button-shine {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
  }

  // Styles responsive pour très petits écrans
  @include xs-only {
    svg {
      width: 50%;
      height: 50%;
    }
  }

  @include very-short-screen {
    svg {
      width: 55%;
      height: 55%;
    }
  }
}

// ===== ANIMATIONS ADDITIONNELLES =====
@keyframes buttonPulse {
  0%,
  100% {
    box-shadow:
      $box-shadow-medium,
      0 0 0 0 rgba($primary-color, 0.4);
  }
  50% {
    box-shadow:
      $box-shadow-medium,
      0 0 0 8px rgba($primary-color, 0);
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(-20px);
  }
}

// ===== CLASSE UTILITAIRE POUR SCREEN READERS =====
.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

// ===== ÉTATS DE FOCUS AMÉLIORÉS =====
.sidebar .bg .links .link a:focus {
  outline: 2px solid $primary-color;
  outline-offset: 2px;
  border-radius: $border-radius-small;
}

.toggle-button:focus-visible {
  outline: 2px solid $primary-color;
  outline-offset: 3px;
}

// ===== SUPPORT POUR LES THÈMES PERSONNALISÉS =====
.sidebar.theme-minimal {
  .bg {
    background: rgba($background-color, 0.98);
    backdrop-filter: blur(10px);
    border-right: 1px solid rgba($text-color, 0.1);

    &::before {
      display: none;
    }

    .links .link {
      background: transparent;
      border: none;

      &:hover {
        background: rgba($primary-color, 0.05);
      }

      &::before {
        display: none;
      }
    }
  }

  .toggle-button {
    background: rgba($background-color, 0.9);
    border: 1px solid rgba($text-color, 0.2);
  }
}

.sidebar.theme-colorful {
  .bg {
    background: linear-gradient(
      135deg,
      rgba($primary-color, 0.1) 0%,
      rgba($secondary-color, 0.1) 50%,
      rgba($accent-color, 0.1) 100%
    );

    .links .link {
      &:nth-child(1):hover {
        border-color: $primary-color;
      }
      &:nth-child(2):hover {
        border-color: $secondary-color;
      }
      &:nth-child(3):hover {
        border-color: $accent-color;
      }
      &:nth-child(4):hover {
        border-color: $success-color;
      }
      &:nth-child(5):hover {
        border-color: $info-color;
      }
    }
  }
}

// ===== OPTIMISATIONS POUR LES GRANDES HAUTEURS =====
@include very-tall-screen {
  .sidebar .bg .links {
    gap: $spacing-xl;
    padding: $spacing-3xl;

    .link {
      padding: $spacing-lg $spacing-xl;
      font-size: 1.2em;
    }

    .sidebar-footer {
      padding-top: $spacing-2xl;
      margin-top: $spacing-3xl;
    }
  }
}

// ===== SUPPORT POUR LES ÉCRANS ULTRA-LARGES =====
@include xxl-up {
  .sidebar .bg {
    width: clamp(20rem, 22vw, 24rem);

    .links {
      padding: $spacing-3xl;
      gap: $spacing-xl;

      .link {
        padding: $spacing-lg $spacing-2xl;
        font-size: clamp(1.3rem, 2.5vw, 1.6rem);
      }
    }
  }
}
